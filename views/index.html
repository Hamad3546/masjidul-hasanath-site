<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Masjidul Hasanath Super-App</title>
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#1b5e20">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<style>
:root { --primary:#1b5e20; --gold:#c5a021; --light:#f4f7f2; }
body { font-family:'Segoe UI',sans-serif; margin:0; padding-bottom:80px; background:#fff; transition:0.3s; }
header { background:var(--primary); color:white; padding:15px; text-align:center; border-radius:0 0 20px 20px; }
.lang-bar { background:#f0f0f0; padding:10px; overflow-x:auto; white-space:nowrap; display:flex; gap:8px; border-bottom:1px solid #ddd; }
.lang-btn { background:white; border:1px solid #ccc; padding:6px 12px; border-radius:20px; font-size:0.75rem; cursor:pointer; transition:0.2s; }
.lang-btn.active { background:var(--gold); color:white; border-color:var(--gold); }
.content-section { display:none; padding:20px; animation:fadeIn 0.4s; }
.active-section { display:block; }
@keyframes fadeIn { from{opacity:0} to{opacity:1} }
.card { background:var(--light); padding:20px; border-radius:15px; margin-bottom:15px; border-left:5px solid var(--gold); box-shadow:0 2px 8px rgba(0,0,0,0.05); }
.btn { background:var(--primary); color:white; border:none; padding:12px; border-radius:10px; width:100%; font-weight:bold; cursor:pointer; margin-top:10px; }
.arabic { font-size:1.8rem; text-align:right; display:block; margin:10px 0; font-family:'Traditional Arabic',serif; }
.bottom-nav { position:fixed; bottom:0; width:100%; background:white; display:flex; justify-content:space-around; padding:12px 0; border-top:1px solid #eee; box-shadow:0 -3px 15px rgba(0,0,0,0.1); z-index:9999; }
.nav-item { text-align:center; color:#777; font-size:0.7rem; cursor:pointer; flex:1; transition:0.3s; }
.nav-item i { font-size:1.3rem; margin-bottom:4px; display:block; }
.nav-item.active { color:var(--primary); font-weight:bold; }
#setup-modal { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); display:flex; align-items:center; justify-content:center; z-index:10000; }
#setup-content { background:white; padding:30px; border-radius:20px; width:90%; max-width:400px; text-align:center; }
#setup-content h2 { margin-bottom:15px; }
#setup-content select, #setup-content button { padding:10px; margin:10px 0; width:80%; font-size:1rem; }
</style>
</head>
<body>

<header>
    <div id="site-title" style="font-weight:bold;font-size:1.2rem;">MASJIDUL HASANATH</div>
    <div id="hijri-date" style="color:var(--gold); font-size:0.8rem;"></div>
</header>

<div class="lang-bar" id="lang-bar"></div>

<section id="prayer-sec" class="content-section active-section">
    <h3 id="prayer-heading">Prayer Times</h3>
    <div id="prayer-container">Loading...</div>
    <div class="card">
        <h3>Qibla Direction</h3>
        <div style="text-align:center; font-size:2rem;">
            <i class="fas fa-location-arrow" id="qibla-arrow" style="transform:rotate(0deg); display:inline-block;"></i>
        </div>
        <p style="text-align:center;">Point this arrow towards Qibla</p>
    </div>
</section>

<section id="ramadan-sec" class="content-section">
    <h3 id="ramadan-heading">Ramadan Timetable</h3>
    <div id="ramadan-container">Loading Ramadan Times...</div>
</section>

<section id="dua-sec" class="content-section">
    <h3 id="dua-heading">Daily Duas</h3>
    <div id="dua-container">Loading...</div>
    <button class="btn" id="load-more-btn" onclick="renderDuas()">Show More</button>
</section>

<section id="about-sec" class="content-section">
    <div class="card" style="text-align:center;">
        <i class="fas fa-user-circle" style="font-size:4rem;color:var(--gold);"></i>
        <h2>Developed by Hamad</h2>
        <p>Assalamu Alaikum! I built this platform with love, passion, and hours of dedication. This app is the result of my deep commitment to serve the Ummah and provide everything a Muslim needs in one place.</p>
        <p>Please make dua for me üôè so I can continue serving the community with sincerity and excellence.</p>
        <p><strong id="location">Godamuduna, Sri Lanka</strong></p>
    </div>
</section>

<div class="bottom-nav">
    <div class="nav-item active" onclick="tab('prayer-sec', this)"><i class="fas fa-mosque"></i>Prayer</div>
    <div class="nav-item" onclick="tab('ramadan-sec', this)"><i class="fas fa-calendar"></i>Ramadan</div>
    <div class="nav-item" onclick="tab('dua-sec', this)"><i class="fas fa-hands-praying"></i>Duas</div>
    <div class="nav-item" onclick="tab('about-sec', this)"><i class="fas fa-user-tie"></i>About</div>
</div>

<div id="setup-modal">
    <div id="setup-content">
        <h2>Welcome! Setup your app</h2>
        <label>Select Language:</label>
        <select id="lang-select">
            <option value="en">English</option>
            <option value="si">‡∑É‡∑í‡∂Ç‡∑Ñ‡∂Ω</option>
            <option value="ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</option>
            <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
            <option value="ur">ÿßÿ±ÿØŸà</option>
        </select>
        <br>
        <button onclick="initApp()">Continue</button>
    </div>
</div>

<script>
let currentLang='en', allDuas=[], currentIndex=0;

const uiTexts={
en:{title:"MASJIDUL HASANATH", prayer:"Prayer Times", ramadan:"Ramadan Timetable", dua:"Daily Duas", load:"Show More"},
si:{title:"‡∂∏‡∑É‡∑ä‡∂¢‡∑í‡∂Ø‡∑î‡∂Ω‡∑ä ‡∑Ñ‡∑É‡∂±‡∑è‡∂≠‡∑ä", prayer:"‡∂¥‡∑ä‚Äç‡∂ª‡∑è‡∂ª‡∑ä‡∂Æ‡∂±‡∑è ‡∑Ä‡∑ö‡∂Ω‡∑è‡∑Ä‡∂±‡∑ä", ramadan:"‡∂ª‡∂∏‡∂Ø‡∑è‡∂±‡∑ä ‡∂ö‡∑è‡∂Ω‡∑É‡∂ß‡∑Ñ‡∂±", dua:"‡∂Ø‡∑í‡∂±‡∂¥‡∂≠‡∑è ‡∂Ø‡∑î‡∂Ü", load:"‡∂≠‡∑Ä ‡∂¥‡∑ô‡∂±‡∑ä‡∑Ä‡∂±‡∑ä‡∂±"},
ta:{title:"‡ÆÆ‡Æ∏‡Øç‡Æú‡Æø‡Æ§‡ØÅ‡Æ≤‡Øç ‡Æπ‡Æ∏‡Æ©‡Ææ‡Æ§‡Øç", prayer:"‡Æè‡Æ≤‡Æø‡ÆØ ‡Æ®‡Øá‡Æ∞‡Æô‡Øç‡Æï‡Æ≥‡Øç", ramadan:"‡Æ∞‡ÆÆ‡Æ≥‡Ææ‡Æ©‡Øç ‡ÆÖ‡Æü‡Øç‡Æü‡Æµ‡Æ£‡Øà", dua:"‡Æ§‡Æø‡Æ©‡Æö‡Æ∞‡Æø ‡Æ§‡ØÅ‡ÆÜ‡Æï‡Øç‡Æï‡Æ≥‡Øç", load:"‡ÆÆ‡Øá‡Æ≤‡ØÅ‡ÆÆ‡Øç ‡Æï‡Ææ‡Æü‡Øç‡Æü‡Æµ‡ØÅ‡ÆÆ‡Øç"},
ar:{title:"ŸÖÿ≥ÿ¨ÿØ ÿßŸÑÿ≠ÿ≥ŸÜÿßÿ™", prayer:"ŸÖŸàÿßŸÇŸäÿ™ ÿßŸÑÿµŸÑÿßÿ©", ramadan:"ÿ¨ÿØŸàŸÑ ÿ±ŸÖÿ∂ÿßŸÜ", dua:"ÿßŸÑÿ£ÿØÿπŸäÿ© ÿßŸÑŸäŸàŸÖŸäÿ©", load:"ÿπÿ±ÿ∂ ÿßŸÑŸÖÿ≤ŸäÿØ"},
ur:{title:"ŸÖÿ≥ÿ¨ÿØ ÿßŸÑÿ≠ÿ≥ŸÜÿßÿ™", prayer:"ŸÜŸÖÿßÿ≤€å ÿßŸàŸÇÿßÿ™", ramadan:"ÿ±ŸÖÿ∂ÿßŸÜ ⁄©ÿß ÿ¨ÿØŸàŸÑ", dua:"ÿ±Ÿàÿ≤ÿßŸÜ€Å ⁄©€å ÿØÿπÿßÿ¶€å⁄∫", load:"ŸÖÿ≤€åÿØ ÿØ⁄©⁄æÿßÿ¶€å⁄∫"}
};

function initApp(){currentLang=document.getElementById('lang-select').value;document.getElementById('setup-modal').style.display='none';updateUIText();getLocation();loadDuas();}

function updateUIText(){const t=uiTexts[currentLang];document.getElementById('site-title').innerText=t.title;document.getElementById('prayer-heading').innerText=t.prayer;document.getElementById('ramadan-heading').innerText=t.ramadan;document.getElementById('dua-heading').innerText=t.dua;document.getElementById('load-more-btn').innerText=t.load;}

function tab(id, el){document.querySelectorAll('.content-section').forEach(s=>s.classList.remove('active-section'));document.getElementById(id).classList.add('active-section');document.querySelectorAll('.nav-item').forEach(i=>i.classList.remove('active'));el.classList.add('active');}

// Qibla
function getQiblaDirection(lat1, lon1){const kaabaLat=21.4225*Math.PI/180;const kaabaLon=39.8262*Math.PI/180;const userLat=lat1*Math.PI/180;const userLon=lon1*Math.PI/180;const deltaLon=kaabaLon-userLon;const x=Math.sin(deltaLon);const y=Math.cos(userLat)*Math.tan(kaabaLat)-Math.sin(userLat)*Math.cos(deltaLon);let angle=Math.atan2(x,y)*(180/Math.PI);return (angle+360)%360;}

// Location + Prayer Times
function getLocation(){
if(navigator.geolocation){
navigator.geolocation.getCurrentPosition(pos=>{
const lat=pos.coords.latitude;
const lon=pos.coords.longitude;
document.getElementById('location').innerText=`Lat:${lat.toFixed(2)}, Lon:${lon.toFixed(2)}`;
fetchPrayerTimes(lat,lon);
fetchRamadanTimes(lat,lon);
const angle=getQiblaDirection(lat,lon);
document.getElementById('qibla-arrow').style.transform=`rotate(${angle}deg)`;
},err=>{alert("Location denied. Default used.");});
}else{alert("Geolocation not supported.");}}

function fetchPrayerTimes(lat, lon){
fetch(`https://api.aladhan.com/v1/timings?latitude=${lat}&longitude=${lon}&method=2`)
.then(res=>res.json())
.then(data=>{
const times=data.data.timings;

const prayerNames={
en:{Fajr:'Fajr', Dhuhr:'Duhar', Asr:'Asar', Maghrib:'Maghrib', Isha:'Isha'},
si:{Fajr:'‡∂ã‡∂Ø‡∑ö ‡∂±‡∂∏‡∑É‡∑ä‡∂ö‡∑è‡∂ª‡∂∫', Dhuhr:'‡∂Ø‡∑î‡∑Ñ‡∂ª‡∑ä', Asr:'‡∂Ü‡∑É‡∂ª', Maghrib:'‡∂∏‡∂ú‡∑ä‡∂ª‡∑í‡∂∂‡∑ä', Isha:'‡∂â‡∑Ç‡∑è'},
ta:{Fajr:'‡Æ™‡ØÅ‡Æπ‡ØÇ‡Æ∞‡Øç', Dhuhr:'‡Æ§‡ØÅ‡Æπ‡Æ∞‡Øç', Asr:'‡ÆÖ‡Æö‡Æ∞‡Øç', Maghrib:'‡ÆÆ‡Æï‡Øç‡Æ∞‡Æø‡Æ™‡Øç', Isha:'‡Æà‡Æ∑‡Ææ'},
ar:{Fajr:'ÿßŸÑŸÅÿ¨ÿ±', Dhuhr:'ÿßŸÑÿ∏Ÿáÿ±', Asr:'ÿßŸÑÿπÿµÿ±', Maghrib:'ÿßŸÑŸÖÿ∫ÿ±ÿ®', Isha:'ÿßŸÑÿπÿ¥ÿßÿ°'},
ur:{Fajr:'ŸÅÿ¨ÿ±', Dhuhr:'ÿ∏€Åÿ±', Asr:'ÿπÿµÿ±', Maghrib:'ŸÖÿ∫ÿ±ÿ®', Isha:'ÿπÿ¥ÿßÿ°'}
};
const names=prayerNames[currentLang]||prayerNames.en;

document.getElementById('prayer-container').innerHTML=`
<div class="card">${names.Fajr}: ${times.Fajr}</div>
<div class="card">${names.Dhuhr}: ${times.Dhuhr}</div>
<div class="card">${names.Asr}: ${times.Asr}</div>
<div class="card">${names.Maghrib}: ${times.Maghrib}</div>
<div class="card">${names.Isha}: ${times.Isha}</div>`;
});
}

// Ramadan timetable placeholder
function fetchRamadanTimes(lat, lon){
let container=document.getElementById('ramadan-container');let html='';
for(let i=1;i<=30;i++){html+=`<div class="card">Day ${i}: Sehri 05:00 - Iftar 18:30</div>`;}
container.innerHTML=html;
}

// Duas
async function loadDuas(){try{const res=await fetch('duas.json');allDuas=await res.json();renderDuas();}catch(e){document.getElementById('dua-container').innerText='Upload correct duas.json!';}}

function renderDuas(){const container=document.getElementById('dua-container');const batch=allDuas.slice(currentIndex,currentIndex+10);batch.forEach(d=>{const card=document.createElement('div');card.className='card';card.innerHTML=`<span class="arabic">${d.ar}</span><p>${d[currentLang]}</p>`;container.appendChild(card);});currentIndex+=10;document.getElementById('load-more-btn').style.display=currentIndex>=allDuas.length?'none':'block';}

// Hijri Date
document.getElementById('hijri-date').innerText=new Intl.DateTimeFormat('en-u-ca-islamic-umalqura',{day:'numeric',month:'long',year:'numeric'}).format(new Date());

// Notifications
if("Notification" in window){Notification.requestPermission().then(p=>{if(p==="granted"){setTimeout(()=>{new Notification("Remember to pray on time and recite your duas!");},5000);}});}
</script>
</body>
</html>
