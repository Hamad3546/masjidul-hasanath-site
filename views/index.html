<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Masjidul Hasanath Super-App</title>
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#1b5e20">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<style>
:root { --primary: #1b5e20; --gold: #c5a021; --light: #f4f7f2; }
body { font-family: 'Segoe UI', sans-serif; margin: 0; padding-bottom: 80px; background: #fff; transition: 0.3s; }
header { background: var(--primary); color: white; padding: 15px; text-align: center; border-radius: 0 0 20px 20px; }

.lang-bar { background: #f0f0f0; padding: 10px; overflow-x: auto; white-space: nowrap; display: flex; gap: 8px; border-bottom: 1px solid #ddd; }
.lang-btn { background: white; border: 1px solid #ccc; padding: 6px 12px; border-radius: 20px; font-size: 0.75rem; cursor: pointer; transition: 0.2s; }
.lang-btn.active { background: var(--gold); color: white; border-color: var(--gold); }

.content-section { display: none; padding: 20px; animation: fadeIn 0.4s; }
.active-section { display: block; }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

.card { background: var(--light); padding: 20px; border-radius: 15px; margin-bottom: 15px; border-left: 5px solid var(--gold); box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
.btn { background: var(--primary); color: white; border: none; padding: 12px; border-radius: 10px; width: 100%; font-weight: bold; cursor: pointer; margin-top: 10px; }
.arabic { font-size: 1.8rem; text-align: right; display: block; margin: 10px 0; font-family: 'Traditional Arabic', serif; }

.bottom-nav { position: fixed; bottom: 0; width: 100%; background: white; display: flex; justify-content: space-around; padding: 12px 0; border-top: 1px solid #eee; box-shadow: 0 -3px 15px rgba(0,0,0,0.1); z-index: 9999; }
.nav-item { text-align: center; color: #777; font-size: 0.7rem; cursor: pointer; flex: 1; transition: 0.3s; }
.nav-item i { font-size: 1.3rem; margin-bottom: 4px; display: block; }
.nav-item.active { color: var(--primary); font-weight: bold; }

/* Modal for initial language & location selection */
#setup-modal { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); display:flex; align-items:center; justify-content:center; z-index:10000; }
#setup-content { background:white; padding:30px; border-radius:20px; width:90%; max-width:400px; text-align:center; }
#setup-content h2 { margin-bottom:15px; }
#setup-content select, #setup-content button { padding:10px; margin:10px 0; width:80%; font-size:1rem; }
</style>
</head>
<body>

<header>
    <div id="site-title" style="font-weight:bold;font-size:1.2rem;">MASJIDUL HASANATH</div>
    <div id="hijri-date" style="color: var(--gold); font-size:0.8rem;"></div>
</header>

<!-- Language Bar -->
<div class="lang-bar" id="lang-bar"></div>

<!-- Sections -->
<section id="prayer-sec" class="content-section active-section">
    <h3 id="prayer-heading">Prayer Times</h3>
    <div id="prayer-container">Loading...</div>
</section>

<section id="qibla-sec" class="content-section">
    <h3 id="qibla-heading">Qibla Direction</h3>
    <div id="qibla-container" style="text-align:center; font-size:2rem;">üß≠ Loading...</div>
</section>

<section id="dua-sec" class="content-section">
    <h3 id="dua-heading">Daily Duas</h3>
    <div id="dua-container">Loading...</div>
    <button class="btn" id="load-more-btn" onclick="renderDuas()">Show More</button>
</section>

<section id="learning-sec" class="content-section">
    <h3 id="learning-heading">Islamic Learning</h3>
    <div class="card">Interactive Quran (Offline Reading)</div>
    <div class="card">Hadith Explorer</div>
    <div class="card">Prophets' Stories & Lessons</div>
</section>

<section id="mosque-sec" class="content-section">
    <h3 id="mosque-heading">Nearby Mosques</h3>
    <div class="card" id="mosque-container">Loading nearby mosques...</div>
</section>

<section id="about-sec" class="content-section">
    <div class="card" style="text-align:center;">
        <i class="fas fa-user-circle" style="font-size:4rem;color:var(--gold);"></i>
        <h2 id="about-name">Developed by Hamad</h2>
        <p id="about-bio">Assalamu Alaikum! I built this platform for Masjidul Hasanath.</p>
        <p><strong id="location">Godamuduna, Sri Lanka</strong></p>
    </div>
</section>

<!-- Bottom Navigation -->
<div class="bottom-nav">
    <div class="nav-item active" onclick="tab('prayer-sec', this)"><i class="fas fa-mosque"></i>Prayer</div>
    <div class="nav-item" onclick="tab('qibla-sec', this)"><i class="fas fa-compass"></i>Qibla</div>
    <div class="nav-item" onclick="tab('dua-sec', this)"><i class="fas fa-hands-praying"></i>Duas</div>
    <div class="nav-item" onclick="tab('learning-sec', this)"><i class="fas fa-book"></i>Learn</div>
    <div class="nav-item" onclick="tab('mosque-sec', this)"><i class="fas fa-map-marker-alt"></i>Mosques</div>
    <div class="nav-item" onclick="tab('about-sec', this)"><i class="fas fa-user-tie"></i>About</div>
</div>

<!-- Setup Modal -->
<div id="setup-modal">
    <div id="setup-content">
        <h2>Welcome! Setup your app</h2>
        <label>Select Language:</label>
        <select id="lang-select">
            <option value="en">English</option>
            <option value="si">‡∑É‡∑í‡∂Ç‡∑Ñ‡∂Ω</option>
            <option value="ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</option>
            <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
            <option value="ur">ÿßÿ±ÿØŸà</option>
        </select>
        <br>
        <button onclick="initApp()">Continue</button>
    </div>
</div>

<script>
let currentLang = 'en';
let allDuas = [];
let currentIndex = 0;

// UI Texts
const uiTexts = {
    en: {title:"MASJIDUL HASANATH", prayer:"Prayer Times", qibla:"Qibla Direction", dua:"Daily Duas", load:"Show More", learn:"Islamic Learning", mosque:"Nearby Mosques", about:"About"},
    si: {title:"‡∂∏‡∑É‡∑ä‡∂¢‡∑í‡∂Ø‡∑î‡∂Ω‡∑ä ‡∑Ñ‡∑É‡∂±‡∑è‡∂≠‡∑ä", prayer:"‡∂¥‡∑ä‚Äç‡∂ª‡∑è‡∂ª‡∑ä‡∂Æ‡∂±‡∑è ‡∑Ä‡∑ö‡∂Ω‡∑è‡∑Ä‡∂±‡∑ä", qibla:"‡∂ö‡∑í‡∂∂‡∑ä‡∂Ω‡∑è ‡∂Ø‡∑í‡∑Å‡∑è‡∑Ä", dua:"‡∂Ø‡∑í‡∂±‡∂¥‡∂≠‡∑è ‡∂Ø‡∑î‡∂Ü", load:"‡∂≠‡∑Ä ‡∂¥‡∑ô‡∂±‡∑ä‡∑Ä‡∂±‡∑ä‡∂±", learn:"‡∂â‡∑É‡∑ä‡∂Ω‡∑è‡∂∏‡∑í ‡∂Ö‡∂∞‡∑ä‚Äç‡∂∫‡∑è‡∂¥‡∂±‡∂∫", mosque:"‡∂Ω‡∂ü‡∂∏ ‡∂∏‡∑É‡∂¢‡∑í‡∂Ø‡∑î", about:"‡∑É‡∂∏‡∑ä‡∂∂‡∂±‡∑ä‡∂∞‡∑Ä"},
    ta: {title:"‡ÆÆ‡Æ∏‡Øç‡Æú‡Æø‡Æ§‡ØÅ‡Æ≤‡Øç ‡Æπ‡Æ∏‡Æ©‡Ææ‡Æ§‡Øç", prayer:"‡Æè‡Æ≤‡Æø‡ÆØ ‡Æ®‡Øá‡Æ∞‡Æô‡Øç‡Æï‡Æ≥‡Øç", qibla:"‡Æï‡Æø‡Æ™‡Øç‡Æ≤‡Ææ ‡Æ§‡Æø‡Æö‡Øà", dua:"‡Æ§‡Æø‡Æ©‡Æö‡Æ∞‡Æø ‡Æ§‡ØÅ‡ÆÜ‡Æï‡Øç‡Æï‡Æ≥‡Øç", load:"‡ÆÆ‡Øá‡Æ≤‡ØÅ‡ÆÆ‡Øç ‡Æï‡Ææ‡Æü‡Øç‡Æü‡Æµ‡ØÅ‡ÆÆ‡Øç", learn:"‡Æá‡Æ∏‡Øç‡Æ≤‡Ææ‡ÆÆ‡Æø‡ÆØ ‡Æï‡Æ≤‡Øç‡Æµ‡Æø", mosque:"‡Æ™‡Æï‡Øç‡Æï‡ÆÆ‡ØÅ‡Æ≥‡Øç‡Æ≥ ‡ÆÆ‡Æö‡ØÇ‡Æ§‡Æø", about:"‡Æ™‡Æ±‡Øç‡Æ±‡Æø"},
    ar: {title:"ŸÖÿ≥ÿ¨ÿØ ÿßŸÑÿ≠ÿ≥ŸÜÿßÿ™", prayer:"ŸÖŸàÿßŸÇŸäÿ™ ÿßŸÑÿµŸÑÿßÿ©", qibla:"ÿßÿ™ÿ¨ÿßŸá ÿßŸÑŸÇÿ®ŸÑÿ©", dua:"ÿßŸÑÿ£ÿØÿπŸäÿ© ÿßŸÑŸäŸàŸÖŸäÿ©", load:"ÿπÿ±ÿ∂ ÿßŸÑŸÖÿ≤ŸäÿØ", learn:"ÿßŸÑÿ™ÿπŸÑŸäŸÖ ÿßŸÑÿ•ÿ≥ŸÑÿßŸÖŸä", mosque:"ÿßŸÑŸÖÿ≥ÿßÿ¨ÿØ ÿßŸÑŸÇÿ±Ÿäÿ®ÿ©", about:"ÿ≠ŸàŸÑ"},
    ur: {title:"ŸÖÿ≥ÿ¨ÿØ ÿßŸÑÿ≠ÿ≥ŸÜÿßÿ™", prayer:"ŸÜŸÖÿßÿ≤€å ÿßŸàŸÇÿßÿ™", qibla:"ŸÇÿ®ŸÑ€Å ⁄©ÿß ÿ±ÿÆ", dua:"ÿ±Ÿàÿ≤ÿßŸÜ€Å ⁄©€å ÿØÿπÿßÿ¶€å⁄∫", load:"ŸÖÿ≤€åÿØ ÿØ⁄©⁄æÿßÿ¶€å⁄∫", learn:"ÿßÿ≥ŸÑÿßŸÖ€å ÿ™ÿπŸÑ€åŸÖ", mosque:"ŸÇÿ±€åÿ® ⁄©€í ŸÖÿ≥ÿßÿ¨ÿØ", about:"⁄©€í ÿ®ÿßÿ±€í ŸÖ€å⁄∫"}
};

// Set language and close modal
function initApp(){
    currentLang = document.getElementById('lang-select').value;
    document.getElementById('setup-modal').style.display = 'none';
    updateUIText();
    getLocation();
    loadDuas();
}

// Update UI Texts
function updateUIText(){
    const t = uiTexts[currentLang];
    document.getElementById('site-title').innerText = t.title;
    document.getElementById('prayer-heading').innerText = t.prayer;
    document.getElementById('qibla-heading').innerText = t.qibla;
    document.getElementById('dua-heading').innerText = t.dua;
    document.getElementById('load-more-btn').innerText = t.load;
    document.getElementById('learning-heading').innerText = t.learn;
    document.getElementById('mosque-heading').innerText = t.mosque;
}

// Bottom nav tab
function tab(id, el){
    document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active-section'));
    document.getElementById(id).classList.add('active-section');
    document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
    el.classList.add('active');
}

// Location & Prayer Times
function getLocation(){
    if(navigator.geolocation){
        navigator.geolocation.getCurrentPosition(pos=>{
            const lat=pos.coords.latitude;
            const lon=pos.coords.longitude;
            document.getElementById('location').innerText=`Lat: ${lat.toFixed(2)}, Lon: ${lon.toFixed(2)}`;
            fetchPrayerTimes(lat, lon);
            showQibla(lat, lon);
            showNearbyMosques(lat, lon);
        },err=>{
            alert("Location access denied. Default location used.");
        });
    }else{alert("Geolocation not supported.");}
}

// Fake prayer times example (replace with API if desired)
function fetchPrayerTimes(lat, lon){
    const container = document.getElementById('prayer-container');
    const times = ["Fajr: 05:00","Dhuhr: 12:30","Asr: 15:45","Maghrib: 18:20","Isha: 19:45"];
    container.innerHTML = times.map(t=>`<div class="card">${t}</div>`).join('');
}

// Qibla direction
function showQibla(lat, lon){
    // Using simple compass emoji as placeholder
    document.getElementById('qibla-container').innerText = "üß≠ Point towards Kaaba";
}

// Nearby Mosques (static example, can integrate Google Maps API)
function showNearbyMosques(lat, lon){
    const container=document.getElementById('mosque-container');
    container.innerHTML=`<div>Masjid Al-Falah - 0.5km</div><div>Masjid Al-Noor - 1.2km</div>`;
}

// Load Duas
async function loadDuas(){
    try{
        const res=await fetch('duas.json');
        allDuas=await res.json();
        renderDuas();
    }catch(e){
        document.getElementById('dua-container').innerText='Upload duas.json';
    }
}

function renderDuas(){
    const container=document.getElementById('dua-container');
    const batch=allDuas.slice(currentIndex,currentIndex+10);
    batch.forEach(d=>{
        const card=document.createElement('div');
        card.className='card';
        card.innerHTML=`<span class="arabic">${d.ar}</span><p>${d[currentLang]||d.en}</p>`;
        container.appendChild(card);
    });
    currentIndex+=10;
    document.getElementById('load-more-btn').style.display=currentIndex>=allDuas.length?'none':'block';
}

// Hijri date
const hijri=new Intl.DateTimeFormat('en-u-ca-islamic-umalqura',{day:'numeric',month:'long',year:'numeric'}).format(new Date());
document.getElementById('hijri-date').innerText=hijri;
</script>
</body>
</html>
